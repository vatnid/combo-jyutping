# Rime schema
# encoding: utf-8
# 呢個 file 係修改自佛振嘅 compo_pinyin.schema.yaml

schema:
  schema_id: combo_jyutping
  name: 宮保粵拼
  version: "0.1"
  author:
    - 淵維 <systemx637@gmail.com>
    - 理烏 <iaskaaca@gmail.com>
  description: |
    以佛振嘅宮保拼音爲基礎嘅粵拼並擊輸入法
    需要配合 jyut6ping3.dict.yaml 使用
    宮保拼音介紹：https://github.com/rime/home/wiki/ComboPinyin
    鳴謝：擇言

switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 西文 ]
  - name: full_shape
    states: [ 半角, 全角 ]
  - name: simplification
    states: [ 漢字, 汉字 ]
  - name: ascii_punct
    states: [ 。，, ．， ]

engine:
  processors:
    - ascii_composer
    - recognizer
    - chord_composer  # 實現並擊按鍵處理
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - punct_translator
    - script_translator
  filters:
    - simplifier
    - uniquifier

editor:
  bindings:
    BackSpace: back_syllable

speller:
  alphabet: zyxwvutsrqponmlkjihgfedcba
  delimiter: " '"
  algebra:
    - derive/([123456])//
    - derive/aa([ptk])/a$1/   # 電腦 keyboard 技術問題，合併 ap/at/ak 同 aap/aat/aak
    - erase/^xx$/

chord_composer:
  # 字母表，包含用嚟並擊嘅掣
  #撳掣雖然有先後，但係形成並擊嗰陣，一律以字母表嘅順序排列
  alphabet: "swxdecfrvgtbhynki,lo.jum "
  # 拼寫運算規則，將一組並擊編碼轉換爲拼音音節
  algebra:
    # 先將物理按鍵字符對應到宮保粵拼鍵位嘅拼音字母
    - 'xlit|swxdecfrvgtbhynki,lo.jum |sczhlfgdbktpoeAuiIOyENnma|'

    # |s|w|x|d|e|c|f|r|v|g|t|b|h|y|n|k|i|,|l|o|.|j|u|m| |   <-- 物理按鍵
    # |s|c|z|h|l|f|g|d|b|k|t|p|o|e|A|u|i|I|O|y|E|N|n|m|a|   <-- 宮保粵拼


    # 以下根據宮保粵拼嘅鍵位分別變換聲母、韻母部分

    # 組合聲母
    - xform/^hgk/kw/
    - xform/^shg/gw/
    - xform/^fb/M/ # M = m 聲母
    - xform/^ld/Q/ # Q = n 聲母
    - xform/^hg/G/ # G = ng 聲母
    - xform/^gk/j/
    - xform/^bp/w/
    - xform/^p/P/
    - xform/^t/T/
    - xform/^k/K/

    # 單撳空白鍵打 space
    - xform/^a$/ /

    # 單撳逗號、句號
    - xform/^I$/,/
    - xform/^E$/./

    # I 掣亦都係等於韻母 ‹i›
    - xform/I/i/

    # 入聲
    - xform/Na$/k/
    - xform/na$/t/
    - xform/ma$/p/

    # ai au
    - xform/ia$/ai/
    - xform/ua$/au/

    # aan
    - xform/Aim/aan/

    # iu ui
    - xform/iy$/iu/
    - xform/uO$/ui/

    # eoi eon eot
    - xform/iO$/eoi/
    - xform/On$/eon/
    - xform/Ot$/eot/

    # em ep
    - xform/ein$/em/
    - xform/eit$/ep/

    # am an ang ap at ak 加返 a
    - xform/^p$/ap/
    - xform/^t$/at/
    - xform/^k$/ak/
    - xform/^m$/am/
    - xform/^n$/an/
    - xform/^N$/ang/
    - xform/([^aeiouyAO])p$/$1ap/
    - xform/([^aeiouyAO])t$/$1at/
    - xform/([^aeiouyAO])k$/$1ak/
    - xform/([^aeiouyAO])m$/$1am/
    - xform/([^aeiouyAO])n$/$1an/
    - xform/([^aeiouyAO])N$/$1aN/

    # i yu u 加 j-/w-
    - xform/^([iy])/j$1/
    - xform/^(u)/w$1/

    # 齋撳聲母補返 -aa
    - xform/^([bPfdTQlgKhjwzcs]w?)$/$1aa/

    # ng aa oe yu m- n- ng- p- t- k-
    - xform/N/ng/
    - xform/A/aa/
    - xform/O/oe/
    - xform/y/yu/
    - xform/M/m/
    - xform/Q/n/
    - xform/G/ng/
    - xform/P/p/
    - xform/T/t/
    - xform/K/k/

  # 並擊完之後個樣
  output_format:
    # 加返 apostrophe
    - "xform/^([bpmfdtlhzcsjw]|ng?|[gk]w?)?([eiou]|aa?|yu|oe|eo)([iumptk]|ng?)?$/$1$2$3'/"
    - "xform/^(m|ng)$/$1'/"

    # delete 唔啱規矩嘅音節
    - "erase/^([A-Za-z]+)$/"


  # 並擊過程中嘅 layout
  prompt_format:
    # 加方括號
    - "xform/^(.*)$/[$1]/"

translator:
  dictionary: jyut6ping3
  prism: combo_jyutping

punctuator:
  import_preset: default

key_binder:
  import_preset: default

recognizer:
  import_preset: default


# 參考用

# b     b
# p     p
# m     fb
# f     f
# d     d
# t     t
# n     ld
# l     l
# g     g
# k     k
# h     h
# ng    hg
# gw    shg
# kw    hgk
# z     z
# c     c
# s     s
# j     gk
# w     bp

# aa    A
# aai   Ai
# aau   Au
# aam   Am
# aan   An / Aim / AIm
# aang  AN
# aap   Ama
# aat   Ana
# aak   ANa
# ai    ia
# au    ua
# am    m
# an    n
# ang   N
# ap    ma
# at    na
# ak    Na
# o     o
# oi    oi
# ou    ou
# on    on
# ong   oN
# ot    ona
# ok    oNa
# oe    O
# eoi   iO
# eon   On
# oeng  ON
# eot   Ona
# oek   ONa
# e     e
# ei    ei
# eu    eu
# em    em / ein
# en    en
# eng   eN
# ep    ema / eina
# et    ena
# ek    eNa
# i     i
# iu    iy
# im    im
# in    in
# ing   iN
# ip    ima
# it    ina
# ik    iNa
# u     u
# ui    uO
# un    un
# ung   uN
# ut    una
# uk    uNa
# yu    y
# yun   yn
# yut   yna
# m     fb
# ng    hg
