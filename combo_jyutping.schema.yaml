# Rime schema
# encoding: utf-8
# 呢個 file 係修改自佛振嘅 compo_pinyin.schema.yaml

schema:
  schema_id: combo_jyutping
  name: 宮保粵拼
  version: "0.1"
  author:
    - 淵維 <systemx637@gmail.com>   # 設計、編程
    - 理烏 <iaskaaca@gmail.com>     # 設計
  description: |
    以佛振嘅宮保拼音爲基礎嘅粵拼並擊（chord typing，即係同時撳多過一個掣）輸入法
    需要配合 jyut6ping3.dict.yaml 使用
    宮保拼音介紹：https://github.com/rime/home/wiki/ComboPinyin
    特別鳴謝：擇言

switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 西文 ]
  - name: full_shape
    states: [ 半角, 全角 ]
  - name: simplification
    states: [ 漢字, 汉字 ]
  - name: ascii_punct
    states: [ 。，, ．， ]

engine:
  processors:
    - ascii_composer
    - recognizer
    - chord_composer  # 實現並擊按鍵處理
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - punct_translator
    - script_translator
  filters:
    - simplifier
    - uniquifier

editor:
  bindings:
    BackSpace: back_syllable

speller:
  alphabet: zyxwvutsrqponmlkjihgfedcba
  delimiter: " '"
  algebra:
    - derive/([123456])//
    # 電腦 keyboard 技術問題，以下合併字典裏面某幾組韻母
    - derive/aa([ptk])/a$1/     # aap/aat/aak = ap/at/ak
    - derive/e(u|m|p|ng|k)/i$1/   # eu/em/ep/eng/ek = iu/im/ip/ing/ik
    - erase/^xx$/

chord_composer:
  # 字母表，包含用嚟撳 chord 嘅掣
  # 撳掣雖然有先後，但係撳 chord 嗰陣，一律以字母表嘅順序排列
  alphabet: "swxdecfrvgtbhynki,lo.jum "
  # 拼寫運算規則，將一組 chord 嘅編碼轉換爲拼音音節
  algebra:
    # 將 physical keyboard 嘅字符對應宮保粵拼 layout 嘅字母
    - 'xlit|swxdecfrvgtbhynki,lo.jum |sczhlfgdbktpoeAuiIOyENnma|'

    # |s|w|x|d|e|c|f|r|v|g|t|b|h|y|n|k|i|,|l|o|.|j|u|m| |  # physical keyboard
    # |s|c|z|h|l|f|g|d|b|k|t|p|o|e|A|u|i|I|O|y|E|N|n|m|a|  # 宮保粵拼


    # 單撳空白、逗號、句號
    - xform/^a$/ /
    - xform/^I$/,/
    - xform/^E$/./

    # 聲母
    - xform/^hgk/kw/
    - xform/^shg/gw/
    - xform/^fb/M/  # M = m 聲母
    - xform/^ld/Q/  # Q = n 聲母
    - xform/^hg/G/  # G = ng 聲母
    - xform/^gk/j/
    - xform/^bp/w/
    - xform/^p/P/   # P = p 聲母
    - xform/^t/T/   # T = t 聲母
    - xform/^k/K/   # K = k 聲母

    # 以下開始轉換韻母

    # 輔助 I 掣
    - xform/I/i/

    # on ot oi 四鍵 shortcut
    - xform/eiyn$/on/
    - xform/eyina$/ona/
    - xform/ouON$/oi/

    # aang aak 四鍵 shortcut
    - xform/AiEm$/AN/
    - xform/AiEma$/ANa/

    # ing ik 三鍵 shortcut
    - xform/ein$/iN/
    - xform/eina$/iNa/

    # un ut 三鍵 shortcut
    - xform/ouN$/un/
    - xform/ouNa$/una/

    # aan aat 三鍵 shortcut
    - xform/Aim/An/
    - xform/Aima/Ana/

    # eon eot eoi 三鍵 shortcut
    - xform/iyn$/On/
    - xform/iyna$/Ona/
    - xform/uON$/iO/    # 注意 iO 唔係 Oi，因爲要跟字母次序

    # eng ek 二鍵 shortcut
    - xform/en$/eN/
    - xform/ena$/eNa/

    # 入聲
    - xform/Na$/k/
    - xform/na$/t/
    - xform/ma$/p/

    # ai au
    - xform/ia$/ai/
    - xform/ua$/au/

    # iu ui
    - xform/iy$/iu/
    - xform/uO$/ui/

    # O 要串做 eo 嘅情況
    - xform/iO$/eoi/    # 注意 iO 唔係 Oi，因爲要跟字母次序
    - xform/On$/eon/
    - xform/Ot$/eot/

    # m n ng 掣加返 a 元音
    - xform/^p$/ap/
    - xform/^t$/at/
    - xform/^k$/ak/
    - xform/^m$/am/
    - xform/^n$/an/
    - xform/^N$/ang/
    - xform/([^aeiouyAO])p$/$1ap/
    - xform/([^aeiouyAO])t$/$1at/
    - xform/([^aeiouyAO])k$/$1ak/
    - xform/([^aeiouyAO])m$/$1am/
    - xform/([^aeiouyAO])n$/$1an/
    - xform/([^aeiouyAO])N$/$1aN/

    # i yu u 加 j/w 聲母
    - xform/^([iy])/j$1/
    - xform/^(u$|u[int])/w$1/

    # 齋撳聲母補返 -aa
    - xform/^([bPfdTQlgKhjwzcs]w?)$/$1aa/

    # 最後嘅 orthography 轉換
    - xform/N/ng/
    - xform/A/aa/
    - xform/O/oe/
    - xform/y/yu/
    - xform/M/m/
    - xform/Q/n/
    - xform/G/ng/
    - xform/P/p/
    - xform/T/t/
    - xform/K/k/

  # 撳完 chord 嘅 display
  output_format:
    # 加返 apostrophe 畀存在嘅音節
    #- xform/^([bpmfdtlhzcsjw]|ng?|[gk]w?)?([eiou]|aa?|yu|oe|eo)([iumptk]|ng?)?$/$1$2$3'/
    # - xform/^()()$/$1$2'/

    # b p m f
    - xform/^([bpm])(aang?|aa[iutk]?|ang?|a[iut]|eng|ei?|ing?|i[utk]|ong|o[uk]?|ung?|u[itk])$/$1$2'/
    - xform/^(bam|bak|mak|bek|pek|bi|mi)$/$1'/
    - xform/^(f)(aa[intk]?|ang?|a[iut]|ei?|ing|i[utk]|ong|ok?|ung?|u[itk]?)$/$1$2'/

    # d t n l
    - xform/^([dtnl])(aa[imnpt]?|ang?|a[iump]|eng|ing?|i[umptk]?|ong|o[iuk]?|eo[it]|ung|uk|yun)$/$1$2'/
    - xform/^([dnl])(a[tk]|ei?|oeng)$/$1$2'/
    - xform/^([dtl])(ek|oe|eon|yut)$/$1$2'/
    - xform/^([dl])(aak|eu|oek)$/$1$2'/
    - xform/^(naau|laau|laang|lem)$/$1'/

    # g k ng h
    - xform/^(n?g|[kh])(aa[iumk]?|ang?|a[iumpt]|e|it|ong|o[ik]?|ung|uk)$/$1$2'/
    - xform/^([gkh])(ei|ing?|i[umpk]|oeng|oe|eoi|yu[nt])$/$1$2'/
    - xform/^(n?g|h)(aang?|aap|o[un])$/$1$2'/
    - xform/^([gk])(oek|u[i]?)$/$1$2'/
    - xform/^([gh])(eng|ot)$/$1$2'/
    - xform/^(gaat|kaat|ngaat|kak|ngak|hak|keu|kut|gep|gun|kek|hek|gi|hi)$/$1'/

    # gw kw w
    - xform/^([gk]?w)(aang|aa[ik]?|a[in]|ik|ong|ok)$/$1$2'/
    - xform/^(g?w)(aa[nt]|ang|at|ing|o)$/$1$2'/
    - xform/^(wu[int]?)$/$1'/

    # z c s
    - xform/^([zcs])(aang?|aa[iumptk]?|ang?|a[iumptk]|eng|ek?|ing?|i[umptk]?|ong|o[iuk]?|oeng|oek|eo[int]|ung|uk|yu[nt]?)$/$1$2'/
    - xform/^(sei)$/$1'/

    # j
    - xform/^(j)(aang|aa[ipk]?|a[iumnpt]|eng|e|ing?|i[umptk]?|o|oeng|oek|eo[in]|ung|uk|yu[nt]?)$/$1$2'/

    # 零聲母同成音節鼻音
    - xform/^(aa?)([iumptk]|ng?)?$/$1$2'/
    - xform/^(ei?)$/$1'/
    - xform/^(o)([iuk]|ng?)?$/$1$2'/
    - xform/^(eot|ung|uk|m|ng)$/$1'/

    # delete 唔啱規矩嘅音節
    - erase/^([A-Za-z]+)$/


  # 撳 chord 過程中嘅 display
  prompt_format:
    # 加方括號
    - xform/^(.*)$/[$1]/

translator:
  dictionary: jyut6ping3    # 用 jyut6ping3.dict 嚟做字典
  prism: combo_jyutping

punctuator:
  import_preset: default

key_binder:
  import_preset: default

recognizer:
  import_preset: default


# 參考用聲韻母對照表

# b     b
# p     p
# m     fb
# f     f
# d     d
# t     t
# n     ld
# l     l
# g     g
# k     k
# h     h
# ng    hg
# gw    shg
# kw    hgk
# z     z
# c     c
# s     s
# j     gk
# w     bp

# aa    A
# aai   Ai
# aau   Au
# aam   Am
# aan   An / Aim
# aang  AN / AiEm
# aap   Ama / ma
# aat   Ana / na / Aima
# aak   ANa / Na / AiEma
# ai    ia
# au    ua
# am    m
# an    n
# ang   N
# ap    ma
# at    na
# ak    Na
# o     o
# oi    oi / ouON
# ou    ou
# on    on / eiyn
# ong   oN
# ot    ona / eyina
# ok    oNa
# oe    O
# eoi   iO / uON
# eon   On / iyn
# oeng  ON
# eot   Ona / iyna
# oek   ONa
# e     e
# ei    ei
# eu    eu / iu
# em    em / im
# eng   eN / en / iN / ein
# ep    ema / ima
# ek    eNa / ena / iNa / eina
# i     i
# iu    iy
# im    im
# in    in
# ing   iN / ein
# ip    ima
# it    ina
# ik    iNa / eina
# u     u
# ui    uO
# un    un / ouN
# ung   uN
# ut    una / ouNa
# uk    uNa
# yu    y
# yun   yn
# yut   yna
# m     fb
# ng    hg
